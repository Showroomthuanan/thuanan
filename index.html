
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nhu Cáº§u Xe ThÃ¡ng 3 - Showroom Thuáº­n An</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script defer src="https://unpkg.com/lucide@latest"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.css">
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="container mx-auto py-10 px-4 md:px-10">
    <h2 class="text-3xl font-bold text-center mb-6 text-blue-600 flex justify-center items-center gap-2">
      <i data-lucide="truck" class="w-8 h-8"></i>
      Nhu Cáº§u Xe ThÃ¡ng 3 - Showroom Thuáº­n An
    </h2>
    
    <div class="bg-white shadow-lg rounded-xl p-6 mb-6">
      <h3 class="text-2xl font-semibold mb-4 text-gray-700 flex items-center gap-2">
        <i data-lucide="plus-circle"></i> ThÃªm ÄÆ¡n HÃ ng
      </h3>
      <form id="orderForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <select class="border p-3 rounded-lg select2" id="tuVanBH">
          <option value="">ğŸ”¹ Chá»n TÆ° Váº¥n BH</option>
          <option>Äinh Trá»ng NhÃ¢n</option>
          <option>LÃª Mai Anh</option>
          <option>LÃª Quá»‘c Thá»‹nh</option>
          <option>LÆ°Æ¡ng Tháº¿ Ngá»c</option>
          <option>Nguyá»…n DÆ° Thuáº­n</option>
          <option>Nguyá»…n HoÃ ng PhÃºc</option>
          <option>Nguyá»…n Minh Trung</option>
          <option>Nguyá»…n Thiá»‡n Tháº£o</option>
          <option>Nguyá»…n VÄƒn GiÃ¡p</option>
          <option>Táº¥t BÃ¡ch TÆ°á»ng</option>
          <option>ThÃ nh Ngá»c Vinh</option>
          <option>VÃµ Minh Tuáº¥n</option>
          <option>VÅ© VÄƒn Äáº¡t</option>
          <option>Tráº§n Thá»‹ Nguyá»‡t Báº¡ch</option>
          <option>LÃª Nhá»±t Quang</option>
          <option>Pháº¡m Trá»ng Huy</option>
          <option>VÅ© Viáº¿t Háº£i</option>
          <option>NguyÃªÌƒn Anh TuÃ¢Ìn</option>
          <option>NguyÃªÌƒn TrÃ¢Ì€n HoaÌ€ng Thanh</option>
          <option>NguyÃªÌƒn HoaÌ€ng ThaÌ£ch</option>
          <option>LyÌ Kim Vinh</option>
          <option>BuÌ€i Anh TaÌ€i</option>
          <option>VuÌƒ ThiÌ£ Trang</option>
        </select>
        <select class="border p-3 rounded-lg select2" id="dongXe">
          <option value="">ğŸš˜ Chá»n DÃ²ng Xe</option>
          <option>VF3</option>
          <option>VF5</option>
          <option>VF6</option>
          <option>VF7</option>
          <option>VF8</option>
          <option>VF9</option>
        </select>
        <input type="text" placeholder="ğŸ·ï¸ PhiÃªn Báº£n" class="border p-3 rounded-lg w-full" id="phienBan">
        <input type="text" placeholder="ğŸ¨ Ngoáº¡i Tháº¥t" class="border p-3 rounded-lg w-full" id="ngoaiThat">
        <input type="text" placeholder="ğŸ›‹ï¸ Ná»™i Tháº¥t" class="border p-3 rounded-lg w-full" id="noiThat">
        <input type="text" placeholder="ğŸ“Œ VSO" class="border p-3 rounded-lg w-full" id="vso">
        <input type="text" placeholder="ğŸ‘¤ TÃªn KH" class="border p-3 rounded-lg w-full" id="tenKH">
        <input type="date" class="border p-3 rounded-lg w-full" id="ngayCoc">
        <input type="text" placeholder="ğŸ’° TÃ¬nh Tráº¡ng Thanh ToÃ¡n" class="border p-3 rounded-lg w-full" id="tinhTrangThanhToan">
        <button type="button" class="col-span-1 md:col-span-2 bg-blue-600 hover:bg-blue-800 text-white font-semibold py-3 rounded-lg transition-transform hover:scale-105" onclick="themDonHang()">
          <i data-lucide="plus"></i> ThÃªm ÄÆ¡n HÃ ng
        </button>
      </form>
    </div>
    
    <div class="bg-white shadow-lg rounded-xl p-6">
      <h3 class="text-2xl font-semibold mb-4 text-gray-700 flex items-center gap-2">
        <i data-lucide="list"></i> Danh SÃ¡ch ÄÆ¡n HÃ ng (<span id="totalOrders">0</span>)
      </h3>
      <!-- Má»¥c tÃ¬m kiáº¿m Ä‘Æ¡n hÃ ng -->
      <div class="mb-4">
        <input type="text" id="searchInput" placeholder="ğŸ” TÃ¬m kiáº¿m Ä‘Æ¡n hÃ ng..." class="border p-3 rounded-lg w-full">
      </div>
      <button class="mb-4 bg-green-500 hover:bg-green-700 text-white py-2 px-4 rounded" onclick="exportToExcel()">ğŸ“¤ Xuáº¥t Excel</button>
      <table class="w-full border-collapse border border-gray-300" id="orderTable">
        <thead>
          <tr class="bg-gray-200">
            <th class="border p-2">TÆ° Váº¥n BH</th>
            <th class="border p-2">DÃ²ng Xe</th>
            <th class="border p-2">PhiÃªn Báº£n</th>
            <th class="border p-2">Ngoáº¡i Tháº¥t</th>
            <th class="border p-2">Ná»™i Tháº¥t</th>
            <th class="border p-2">VSO</th>
            <th class="border p-2">TÃªn KH</th>
            <th class="border p-2">NgÃ y Cá»c</th>
            <th class="border p-2">Thanh ToÃ¡n</th>
            <th class="border p-2">Thá»i Gian Nháº­p Liá»‡u</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  
  <!-- Script tÃ­ch há»£p localStorage -->
  <script>
    // Khi trang Ä‘Æ°á»£c táº£i, láº¥y dá»¯ liá»‡u tá»« localStorage vÃ  hiá»ƒn thá»‹ lÃªn báº£ng
    $(document).ready(function(){
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      orders.forEach(order => {
        let row = `<tr>
          <td class='border p-2'>${order.tuVanBH}</td>
          <td class='border p-2'>${order.dongXe}</td>
          <td class='border p-2'>${order.phienBan}</td>
          <td class='border p-2'>${order.ngoaiThat}</td>
          <td class='border p-2'>${order.noiThat}</td>
          <td class='border p-2'>${order.vso}</td>
          <td class='border p-2'>${order.tenKH}</td>
          <td class='border p-2'>${order.ngayCoc}</td>
          <td class='border p-2'>${order.tinhTrangThanhToan}</td>
          <td class='border p-2'>${order.time}</td>
        </tr>`;
        $("#orderTable tbody").append(row);
      });
      $("#totalOrders").text(orders.length);
    });

    // HÃ m thÃªm Ä‘Æ¡n hÃ ng vÃ  lÆ°u vÃ o localStorage
    function themDonHang() {
      let order = {
        tuVanBH: $("#tuVanBH").val().trim(),
        dongXe: $("#dongXe").val().trim(),
        phienBan: $("#phienBan").val().trim(),
        ngoaiThat: $("#ngoaiThat").val().trim(),
        noiThat: $("#noiThat").val().trim(),
        vso: $("#vso").val().trim(),
        tenKH: $("#tenKH").val().trim(),
        ngayCoc: $("#ngayCoc").val().trim(),
        tinhTrangThanhToan: $("#tinhTrangThanhToan").val().trim(),
        time: new Date().toLocaleString('vi-VN')
      };

      // Láº¥y dá»¯ liá»‡u Ä‘Ã£ lÆ°u (hoáº·c khá»Ÿi táº¡o máº£ng náº¿u chÆ°a cÃ³)
      let orders = JSON.parse(localStorage.getItem("orders")) || [];

      // Kiá»ƒm tra báº¯t buá»™c nháº­p cÃ¡c trÆ°á»ng
      if(Object.values(order).some(val => val === "")) {
        Swal.fire("Lá»—i!", "Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin!", "error");
        return;
      }

      // Kiá»ƒm tra tÃªn khÃ¡ch hÃ ng chá»‰ chá»©a chá»¯
      if(!/^[\p{L}\s]+$/u.test(order.tenKH)) {
  Swal.fire("Lá»—i!", "TÃªn khÃ¡ch hÃ ng chá»‰ Ä‘Æ°á»£c phÃ©p nháº­p chá»¯!", "error");
  return;
      }

      // Kiá»ƒm tra ngÃ y cá»c khÃ´ng Ä‘Æ°á»£c lÃ  ngÃ y trong tÆ°Æ¡ng lai
      if(new Date(order.ngayCoc) > new Date()){
        Swal.fire("Lá»—i!", "NgÃ y cá»c khÃ´ng thá»ƒ lÃ  ngÃ y trong tÆ°Æ¡ng lai!", "error");
        return;
      }

      // Kiá»ƒm tra trÃ¹ng VSO
      if(orders.some(o => o.vso === order.vso)) {
        Swal.fire("Lá»—i!", "VSO Ä‘Ã£ tá»“n táº¡i!", "error");
        return;
      }

      // ThÃªm Ä‘Æ¡n hÃ ng má»›i vÃ o máº£ng vÃ  cáº­p nháº­t localStorage
      orders.push(order);
      localStorage.setItem("orders", JSON.stringify(orders));

      // Cáº­p nháº­t báº£ng hiá»ƒn thá»‹
      let row = `<tr>
        <td class='border p-2'>${order.tuVanBH}</td>
        <td class='border p-2'>${order.dongXe}</td>
        <td class='border p-2'>${order.phienBan}</td>
        <td class='border p-2'>${order.ngoaiThat}</td>
        <td class='border p-2'>${order.noiThat}</td>
        <td class='border p-2'>${order.vso}</td>
        <td class='border p-2'>${order.tenKH}</td>
        <td class='border p-2'>${order.ngayCoc}</td>
        <td class='border p-2'>${order.tinhTrangThanhToan}</td>
        <td class='border p-2'>${order.time}</td>
      </tr>`;
      $("#orderTable tbody").append(row);
      $("#totalOrders").text(orders.length);

      toastr.success("ÄÆ¡n hÃ ng Ä‘Ã£ Ä‘Æ°á»£c thÃªm!");

      // XoÃ¡ dá»¯ liá»‡u trong cÃ¡c input sau khi thÃªm
      $("#orderForm input, #orderForm select").val("");

      // Cuá»™n xuá»‘ng báº£ng náº¿u cáº§n
      $("html, body").animate({
        scrollTop: $("#orderTable").offset().top
      }, 1000);
    }

    // ThÃªm chá»©c nÄƒng tÃ¬m kiáº¿m Ä‘Æ¡n hÃ ng
    $("#searchInput").on("keyup", function() {
      var value = $(this).val().toLowerCase();
      $("#orderTable tbody tr").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
      });
    });
  </script>
</body>
</html>
